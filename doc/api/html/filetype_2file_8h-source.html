<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>file.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>file.h</h1><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment"> * file.h - definitions for file(1) program</font>
00003 <font class="comment"> * @(#)$Id: file.h,v 1.37 2001/07/22 21:04:15 christos Exp $</font>
00004 <font class="comment"> *</font>
00005 <font class="comment"> * Copyright (c) Ian F. Darwin, 1987.</font>
00006 <font class="comment"> * Written by Ian F. Darwin.</font>
00007 <font class="comment"> *</font>
00008 <font class="comment"> * This software is not subject to any license of the American Telephone</font>
00009 <font class="comment"> * and Telegraph Company or of the Regents of the University of California.</font>
00010 <font class="comment"> *</font>
00011 <font class="comment"> * Permission is granted to anyone to use this software for any purpose on</font>
00012 <font class="comment"> * any computer system, and to alter it and redistribute it freely, subject</font>
00013 <font class="comment"> * to the following restrictions:</font>
00014 <font class="comment"> *</font>
00015 <font class="comment"> * 1. The author is not responsible for the consequences of use of this</font>
00016 <font class="comment"> *    software, no matter how awful, even if they arise from flaws in it.</font>
00017 <font class="comment"> *</font>
00018 <font class="comment"> * 2. The origin of this software must not be misrepresented, either by</font>
00019 <font class="comment"> *    explicit claim or by omission.  Since few users ever read sources,</font>
00020 <font class="comment"> *    credits must appear in the documentation.</font>
00021 <font class="comment"> *</font>
00022 <font class="comment"> * 3. Altered versions must be plainly marked as such, and must not be</font>
00023 <font class="comment"> *    misrepresented as being the original software.  Since few users</font>
00024 <font class="comment"> *    ever read sources, credits must appear in the documentation.</font>
00025 <font class="comment"> *</font>
00026 <font class="comment"> * 4. This notice may not be removed or altered.</font>
00027 <font class="comment"> */</font>
00028 
00029 <font class="preprocessor">#ifndef __file_h__</font>
00030 <font class="preprocessor"></font><font class="preprocessor">#define __file_h__</font>
00031 <font class="preprocessor"></font>
00032 <font class="preprocessor">#ifdef HAVE_CONFIG_H</font>
00033 <font class="preprocessor"></font><font class="preprocessor">#include &lt;config.h&gt;</font>
00034 <font class="preprocessor">#endif</font>
00035 <font class="preprocessor"></font>
00036 <font class="keyword">typedef</font> <font class="keywordtype">int</font> int32;
00037 <font class="keyword">typedef</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> uint32;
00038 <font class="keyword">typedef</font> <font class="keywordtype">short</font> int16;
00039 <font class="keyword">typedef</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> uint16;
00040 <font class="keyword">typedef</font> <font class="keywordtype">char</font> int8;
00041 <font class="keyword">typedef</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> uint8;
00042 
00043 <font class="preprocessor">#ifndef HOWMANY</font>
00044 <font class="preprocessor"></font><font class="preprocessor"># define HOWMANY 16384      </font><font class="comment">/* how much of the file to look at */</font>
00045 <font class="preprocessor">#endif</font>
00046 <font class="preprocessor"></font><font class="preprocessor">#define MAXMAGIS 1000       </font><font class="comment">/* max entries in /etc/magic */</font>
00047 <font class="preprocessor">#define MAXDESC 50      </font><font class="comment">/* max leng of text description */</font>
00048 <font class="preprocessor">#define MAXstring 32        </font><font class="comment">/* max leng of "string" types */</font>
00049 
00050 <font class="preprocessor">#define MAGICNO     0xF11E041C</font>
00051 <font class="preprocessor"></font><font class="preprocessor">#define VERSIONNO   1</font>
00052 <font class="preprocessor"></font>
00053 <font class="preprocessor">#define CHECK   1</font>
00054 <font class="preprocessor"></font><font class="preprocessor">#define COMPILE 2</font>
00055 <font class="preprocessor"></font>
00056 <font class="keyword">struct </font>magic {
00057     uint16 cont_level;<font class="comment">/* level of "&gt;" */</font>
00058     uint8 nospflag; <font class="comment">/* supress space character */</font>
00059     uint8 flag;
00060 <font class="preprocessor">#define INDIR   1       </font><font class="comment">/* if '&gt;(...)' appears,  */</font>
00061 <font class="preprocessor">#define UNSIGNED 2      </font><font class="comment">/* comparison is unsigned */</font>
00062 <font class="preprocessor">#define OFFADD  4       </font><font class="comment">/* if '&gt;&amp;' appears,  */</font>
00063     uint8 reln;     <font class="comment">/* relation (0=eq, '&gt;'=gt, etc) */</font>
00064     uint8 vallen;       <font class="comment">/* length of string value, if any */</font>
00065     uint8 type;     <font class="comment">/* int, short, long or string. */</font>
00066     uint8 in_type;      <font class="comment">/* type of indirrection */</font>
00067 <font class="preprocessor">#define             BYTE    1</font>
00068 <font class="preprocessor"></font><font class="preprocessor">#define             SHORT   2</font>
00069 <font class="preprocessor"></font><font class="preprocessor">#define             LONG    4</font>
00070 <font class="preprocessor"></font><font class="preprocessor">#define             STRING  5</font>
00071 <font class="preprocessor"></font><font class="preprocessor">#define             DATE    6</font>
00072 <font class="preprocessor"></font><font class="preprocessor">#define             BESHORT 7</font>
00073 <font class="preprocessor"></font><font class="preprocessor">#define             BELONG  8</font>
00074 <font class="preprocessor"></font><font class="preprocessor">#define             BEDATE  9</font>
00075 <font class="preprocessor"></font><font class="preprocessor">#define             LESHORT 10</font>
00076 <font class="preprocessor"></font><font class="preprocessor">#define             LELONG  11</font>
00077 <font class="preprocessor"></font><font class="preprocessor">#define             LEDATE  12</font>
00078 <font class="preprocessor"></font><font class="preprocessor">#define             PSTRING 13</font>
00079 <font class="preprocessor"></font><font class="preprocessor">#define             LDATE   14</font>
00080 <font class="preprocessor"></font><font class="preprocessor">#define             BELDATE 15</font>
00081 <font class="preprocessor"></font><font class="preprocessor">#define             LELDATE 16</font>
00082 <font class="preprocessor"></font>    uint8 in_op;        <font class="comment">/* operator for indirection */</font>
00083     uint8 mask_op;      <font class="comment">/* operator for mask */</font>
00084 <font class="preprocessor">#define             OPAND   1</font>
00085 <font class="preprocessor"></font><font class="preprocessor">#define             OPOR    2</font>
00086 <font class="preprocessor"></font><font class="preprocessor">#define             OPXOR   3</font>
00087 <font class="preprocessor"></font><font class="preprocessor">#define             OPADD   4</font>
00088 <font class="preprocessor"></font><font class="preprocessor">#define             OPMINUS 5</font>
00089 <font class="preprocessor"></font><font class="preprocessor">#define             OPMULTIPLY  6</font>
00090 <font class="preprocessor"></font><font class="preprocessor">#define             OPDIVIDE    7</font>
00091 <font class="preprocessor"></font><font class="preprocessor">#define             OPMODULO    8</font>
00092 <font class="preprocessor"></font><font class="preprocessor">#define             OPINVERSE   0x80</font>
00093 <font class="preprocessor"></font>    int32 offset;       <font class="comment">/* offset to magic number */</font>
00094     int32 in_offset;    <font class="comment">/* offset from indirection */</font>
00095     <font class="keyword">union </font>VALUETYPE {
00096         <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> b;
00097         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> h;
00098         uint32 l;
00099         <font class="keywordtype">char</font> s[MAXstring];
00100         <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> hs[2];    <font class="comment">/* 2 bytes of a fixed-endian "short" */</font>
00101         <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> hl[4];    <font class="comment">/* 4 bytes of a fixed-endian "long" */</font>
00102     } value;        <font class="comment">/* either number or string */</font>
00103     uint32 mask;    <font class="comment">/* mask before comparison with value */</font>
00104     <font class="keywordtype">char</font> desc[MAXDESC]; <font class="comment">/* description */</font>
00105 };
00106 
00107 <font class="preprocessor">#define BIT(A)   (1 &lt;&lt; (A))</font>
00108 <font class="preprocessor"></font><font class="preprocessor">#define STRING_IGNORE_LOWERCASE     BIT(0)</font>
00109 <font class="preprocessor"></font><font class="preprocessor">#define STRING_COMPACT_BLANK        BIT(1)</font>
00110 <font class="preprocessor"></font><font class="preprocessor">#define STRING_COMPACT_OPTIONAL_BLANK   BIT(2)</font>
00111 <font class="preprocessor"></font><font class="preprocessor">#define CHAR_IGNORE_LOWERCASE       'c'</font>
00112 <font class="preprocessor"></font><font class="preprocessor">#define CHAR_COMPACT_BLANK      'B'</font>
00113 <font class="preprocessor"></font><font class="preprocessor">#define CHAR_COMPACT_OPTIONAL_BLANK 'b'</font>
00114 <font class="preprocessor"></font>
00115 
00116 <font class="comment">/* list of magic entries */</font>
00117 <font class="keyword">struct </font>mlist {
00118     <font class="keyword">struct </font>magic *magic;        <font class="comment">/* array of magic entries */</font>
00119     uint32 nmagic;          <font class="comment">/* number of entries in array */</font>
00120     <font class="keyword">struct </font>mlist *next, *prev;
00121 };
00122 
00123 <font class="preprocessor">#include &lt;stdio.h&gt;</font>  <font class="comment">/* Include that here, to make sure __P gets defined */</font>
00124 <font class="preprocessor">#include &lt;errno.h&gt;</font>
00125 
00126 <font class="preprocessor">#ifndef __P</font>
00127 <font class="preprocessor"></font><font class="preprocessor"># if defined(__STDC__) || defined(__cplusplus)</font>
00128 <font class="preprocessor"></font><font class="preprocessor">#  define __P(a) a</font>
00129 <font class="preprocessor"></font><font class="preprocessor"># else</font>
00130 <font class="preprocessor"></font><font class="preprocessor">#  define __P(a) ()</font>
00131 <font class="preprocessor"></font><font class="preprocessor">#  define const</font>
00132 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00133 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00134 <font class="preprocessor"></font>
00135 <font class="keyword">extern</font> <font class="keywordtype">int</font>   apprentice     __P((<font class="keyword">const</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00136 <font class="keyword">extern</font> <font class="keywordtype">int</font>   ascmagic       __P((<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00137 <font class="keyword">extern</font> <font class="keywordtype">void</font>  error      __P((<font class="keyword">const</font> <font class="keywordtype">char</font> *, ...));
00138 <font class="keyword">extern</font> <font class="keywordtype">void</font>  ckfputs        __P((<font class="keyword">const</font> <font class="keywordtype">char</font> *, FILE *));
00139 <font class="keyword">struct </font>stat;
00140 <font class="keyword">extern</font> <font class="keywordtype">int</font>   fsmagic        __P((<font class="keyword">const</font> <font class="keywordtype">char</font> *, <font class="keyword">struct</font> stat *));
00141 <font class="keyword">extern</font> <font class="keywordtype">char</font> *fmttime        __P((<font class="keywordtype">long</font>, <font class="keywordtype">int</font>));
00142 <font class="keyword">extern</font> <font class="keywordtype">int</font>   is_compress    __P((<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font> *));
00143 <font class="keyword">extern</font> <font class="keywordtype">int</font>   is_tar     __P((<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00144 <font class="keyword">extern</font> <font class="keywordtype">void</font>  magwarn        __P((<font class="keyword">const</font> <font class="keywordtype">char</font> *, ...));
00145 <font class="keyword">extern</font> <font class="keywordtype">void</font>  mdump      __P((<font class="keyword">struct</font> magic *));
00146 <font class="keyword">extern</font> <font class="keywordtype">int</font>  process     __P((<font class="keyword">const</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00147 <font class="keyword">extern</font> <font class="keywordtype">void</font>  showstr        __P((FILE *, <font class="keyword">const</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00148 <font class="keyword">extern</font> <font class="keywordtype">int</font>   softmagic      __P((<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00149 <font class="keyword">extern</font> <font class="keywordtype">int</font>   tryit      __P((<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00150 <font class="keyword">extern</font> <font class="keywordtype">int</font>   zmagic     __P((<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00151 <font class="keyword">extern</font> <font class="keywordtype">void</font>  ckfprintf      __P((FILE *, <font class="keyword">const</font> <font class="keywordtype">char</font> *, ...));
00152 <font class="keyword">extern</font> uint32 signextend    __P((<font class="keyword">struct</font> magic *, <font class="keywordtype">unsigned</font> int32));
00153 <font class="keyword">extern</font> <font class="keywordtype">void</font> tryelf      __P((<font class="keywordtype">int</font>, <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *, <font class="keywordtype">int</font>));
00154 
00155 <font class="keyword">extern</font> <font class="keywordtype">char</font> *progname;      <font class="comment">/* the program name             */</font>
00156 <font class="keyword">extern</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *magicfile;   <font class="comment">/* name of the magic file       */</font>
00157 <font class="keyword">extern</font> <font class="keywordtype">int</font> lineno;      <font class="comment">/* current line number in magic file    */</font>
00158 
00159 <font class="keyword">extern</font> <font class="keyword">struct </font>mlist mlist;  <font class="comment">/* list of arrays of magic entries  */</font>
00160 <font class="preprocessor">#define debug debug_file</font>
00161 <font class="preprocessor"></font><font class="keyword">extern</font> <font class="keywordtype">int</font> debug;       <font class="comment">/* enable debugging?            */</font>
00162 <font class="comment">//extern int zflag;     /* process compressed files?        */</font>
00163 <font class="comment">//extern int lflag;     /* follow symbolic links?       */</font>
00164 <font class="comment">//extern int sflag;     /* read/analyze block special files?    */</font>
00165 <font class="comment">//extern int iflag;     /* Output types as mime-types       */</font>
00166 
00167 <font class="keyword">extern</font> <font class="keywordtype">int</font> optind;      <font class="comment">/* From getopt(3)           */</font>
00168 <font class="keyword">extern</font> <font class="keywordtype">char</font> *optarg;
00169 
00170 <font class="preprocessor">#ifndef HAVE_STRERROR</font>
00171 <font class="preprocessor"></font><font class="keyword">extern</font> <font class="keywordtype">int</font> sys_nerr;
00172 <font class="keyword">extern</font> <font class="keywordtype">char</font> *sys_errlist[];
00173 <font class="preprocessor">#define strerror(e) \</font>
00174 <font class="preprocessor">    (((e) &gt;= 0 &amp;&amp; (e) &lt; sys_nerr) ? sys_errlist[(e)] : "Unknown error")</font>
00175 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00176 <font class="preprocessor"></font>
00177 <font class="preprocessor">#ifndef HAVE_STRTOUL</font>
00178 <font class="preprocessor"></font><font class="preprocessor">#define strtoul(a, b, c)    strtol(a, b, c)</font>
00179 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00180 <font class="preprocessor"></font>
00181 <font class="preprocessor">#if defined(HAVE_MMAP) &amp;&amp; defined(HAVE_SYS_MMAN_H) &amp;&amp; !defined(QUICK)</font>
00182 <font class="preprocessor"></font><font class="preprocessor">#define QUICK</font>
00183 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00184 <font class="preprocessor"></font>
00185 <font class="preprocessor">#ifdef __STDC__</font>
00186 <font class="preprocessor"></font><font class="preprocessor">#define FILE_RCSID(id) \</font>
00187 <font class="preprocessor">static const char *rcsid(const char *p) { \</font>
00188 <font class="preprocessor">    return rcsid(p = id); \</font>
00189 <font class="preprocessor">}</font>
00190 <font class="preprocessor"></font><font class="preprocessor">#else</font>
00191 <font class="preprocessor"></font><font class="preprocessor">#define FILE_RCSID(id) static char rcsid[] = id;</font>
00192 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00193 <font class="preprocessor"></font>
00194 <font class="preprocessor">#endif </font><font class="comment">/* __file_h__ */</font>
</pre></div><hr><address><small>Generated on Thu Jul 11 16:11:24 2002 for MyCDCatalog by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
